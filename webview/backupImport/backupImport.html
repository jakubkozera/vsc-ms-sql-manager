<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Database Backup</title>
    <link rel="stylesheet" href="{{cssUri}}">
</head>
<body>
    <div class="container">
        <h1>Import Database Backup</h1>
        
        <div class="connection-info">
            <div class="connection-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9.785 6l8.215 8.215l-2.054 2.054a5.81 5.81 0 1 1 -8.215 -8.215l2.054 -2.054z" />
                    <path d="M4 20l3.5 -3.5" />
                    <path d="M15 4l-3.5 3.5" />
                    <path d="M20 9l-3.5 3.5" />
                </svg>
                <span id="connectionName">Loading...</span>
            </div>
            <div class="connection-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z" />
                    <path d="M3 12m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z" />
                    <path d="M7 8l0 .01" />
                    <path d="M7 16l0 .01" />
                </svg>
                <span id="serverName">Loading...</span>
            </div>
        </div>

        <form id="importForm">
            <div class="form-group">
                <label for="fileFormat">File Format *</label>
                <select id="fileFormat" onchange="updateFormatOptions()">
                    <option value="bak">BAK - Database Backup (.bak)</option>
                    <option value="bacpac">BACPAC - Data-tier Application (.bacpac)</option>
                </select>
                <div class="help-text" id="formatHelp">Choose file format: BAK for restore or BACPAC for import</div>
            </div>

            <div class="form-group">
                <label for="backupPath">Source File *</label>
                <div class="file-input-group">
                    <input type="text" id="backupPath" required placeholder="C:\\backup\\database_backup.bak">
                    <button type="button" id="selectFileBtn">Browse...</button>
                    <button type="button" id="analyzeBtn" disabled>Analyze</button>
                </div>
                <div class="help-text" id="pathHelp">Select the .bak file to restore from</div>
                <div class="help-text" style="color: var(--vscode-textPreformat-foreground); font-style: italic; margin-top: 8px;">
                    <strong>SQL Server Express Auto-Fix:</strong> The extension will automatically copy backup files to accessible locations if needed for SQL Server permissions.
                </div>
                <div id="backupInfoSection" style="display: none;" class="info-section">
                    <strong>Backup Information:</strong><br>
                    <span id="backupInfo">No backup analyzed yet</span>
                </div>
            </div>

            <div class="form-group">
                <label>Target Database Selection</label>
                <div class="target-database-switch">
                    <div class="target-option active" id="newDatabaseOption" data-target="new">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 6c0 1.657 3.582 3 8 3s8 -1.343 8 -3s-3.582 -3 -8 -3s-8 1.343 -8 3" />
                            <path d="M4 6v6c0 1.657 3.582 3 8 3c1.075 0 2.1 -.08 3.037 -.224" />
                            <path d="M20 12v-6" />
                            <path d="M4 12v6c0 1.657 3.582 3 8 3c.166 0 .331 -.002 .495 -.006" />
                            <path d="M16 19h6" />
                            <path d="M19 16v6" />
                        </svg>
                        Create New Database
                    </div>
                    <div class="target-option" id="existingDatabaseOption" data-target="existing">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 3m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                            <path d="M15 15m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                            <path d="M21 11v-3a2 2 0 0 0 -2 -2h-6l3 3m0 -6l-3 3" />
                            <path d="M3 13v3a2 2 0 0 0 2 2h6l-3 -3m0 6l3 -3" />
                        </svg>
                        Replace Existing Database
                    </div>
                </div>
            </div>

            <div class="form-group" id="newDatabaseGroup">
                <label for="targetDatabase">Target Database Name *</label>
                <input type="text" id="targetDatabase" required placeholder="MyRestoredDatabase">
                <div class="help-text">Name of the database to create/restore to</div>
                <div id="databaseExistsWarning" class="warning" style="display: none;">
                    Database already exists! Switch to "Replace Existing Database" mode or choose a different name.
                </div>
                <div class="form-row" style="margin-top: 10px;">
                    <button type="button" id="suggestNewNameBtn" style="padding: 4px 8px; font-size: 12px;">Suggest New Name</button>
                    <button type="button" id="useOriginalNameBtn" style="padding: 4px 8px; font-size: 12px;" disabled>Use Original Name</button>
                </div>
            </div>

            <div class="form-group" id="existingDatabaseGroup" style="display: none;">
                <label for="existingDatabases">Select Database to Replace *</label>
                <select id="existingDatabases">
                    <option value="">-- Select existing database --</option>
                </select>
                <div class="help-text">Choose which existing database to replace with the backup</div>
            </div>

            <div class="advanced-section" id="advancedSection">
                <button type="button" class="collapsible-header" id="advancedToggle">
                    <svg class="collapsible-icon collapsed" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9l6 6l6 -6" />
                    </svg>
                    Advanced Options
                </button>
                
                <div class="collapsible-content" id="advancedContent">
                    <div class="form-group" id="restoreOptionsSection">
                        <label>Restore Options</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="checksum">
                                <label for="checksum">Verify checksum</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="continueAfterError">
                                <label for="continueAfterError">Continue after error</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="noRecovery">
                                <label for="noRecovery">No recovery (for log shipping)</label>
                            </div>
                        </div>
                        <div class="help-text">
                            Checksum verifies backup integrity. No recovery leaves database in restoring state.
                        </div>
                    </div>

                    <div class="form-group" id="fileRelocationSection">
                        <label>File Relocation (Auto-generated if empty)</label>
                        <div class="form-row">
                            <div>
                                <label for="relocateData">Data file path (.mdf)</label>
                                <input type="text" id="relocateData" placeholder="Auto-generated from SQL Server default paths">
                            </div>
                            <div>
                                <label for="relocateLog">Log file path (.ldf)</label>
                                <input type="text" id="relocateLog" placeholder="Auto-generated from SQL Server default paths">
                            </div>
                        </div>
                        <div class="help-text">
                            <strong>Auto-Fill:</strong> Leave empty to automatically use SQL Server's default data directory.<br>
                            <strong>Custom:</strong> Specify custom locations if you want files in specific folders.
                        </div>
                    </div>
                </div>
            </div>

            <div class="message" id="messageSection">
                <span id="messageText"></span>
            </div>

            <div class="buttons">
                <button type="button" class="secondary" id="cancelBtn">Cancel</button>
                <button type="submit" class="primary" id="importBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 6c0 1.657 3.582 3 8 3s8 -1.343 8 -3s-3.582 -3 -8 -3s-8 1.343 -8 3" />
                        <path d="M4 6v6c0 1.657 3.582 3 8 3c.856 0 1.68 -.05 2.454 -.144m5.546 -2.856v-6" />
                        <path d="M4 12v6c0 1.657 3.582 3 8 3c.171 0 .341 -.002 .51 -.006" />
                        <path d="M19 22v-6" />
                        <path d="M22 19l-3 -3l-3 3" />
                    </svg>
                    Import Backup
                </button>
            </div>
        </form>

        <!-- Backdrop loader -->
        <div id="backdrop" class="backdrop">
            <div class="loader">
                <div class="spinner"></div>
                <div class="loader-message" id="loaderMessage">Importing database backup...</div>
                <div class="loader-detail" id="loaderDetail">Please wait, this may take several minutes</div>
            </div>
        </div>
    </div>

    <script src="{{jsUri}}"></script>
</body>
</html>