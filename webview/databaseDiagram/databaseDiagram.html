<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Diagram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    <link rel="stylesheet" href="{{cssUri}}">
</head>
<body>
    <div class="toolbar">
        <button onclick="resetZoom()" data-tooltip="Reset View">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />
            </svg>
        </button>
        <button onclick="fitToScreen()" data-tooltip="Fit to Screen">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 12v-6a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v6" />
                <path d="M10 18h-7" />
                <path d="M21 18h-7" />
                <path d="M6 15l-3 3l3 3" />
                <path d="M18 15l3 3l-3 3" />
            </svg>
        </button>
        <div class="toolbar-divider"></div>
        <button onclick="toggleFilterPanel()" data-tooltip="Filter Tables">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z" />
            </svg>
        </button>
        <div class="toolbar-divider"></div>
        <button onclick="exportAsSVG()" data-tooltip="Export to SVG">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2" />
                <path d="M9 12h12l-3 -3" />
                <path d="M18 15l3 -3" />
            </svg>
        </button>
    </div>
    
    <div id="filterPanel" class="filter-panel">
        <div class="filter-header">
            <span>Filter Tables</span>
            <span style="cursor: pointer;" onclick="toggleFilterPanel()">âœ•</span>
        </div>
        <div class="filter-search">
            <input type="text" id="filterSearch" placeholder="Search tables..." oninput="filterTableList()">
        </div>
        <div class="filter-actions">
            <button onclick="selectAllTables()">Select All</button>
            <button onclick="deselectAllTables()">Deselect All</button>
        </div>
        <div class="filter-list" id="filterList">
            <!-- Table checkboxes will be inserted here -->
        </div>
    </div>
    
    <svg id="diagram"></svg>

    <script>
        const TABLES_DATA = {{tablesJson}};
        const RELATIONSHIPS_DATA = {{relationshipsJson}};
        const DATABASE_NAME = "{{databaseName}}";
    </script>
    <script src="{{jsUri}}"></script>
</body>
</html>
